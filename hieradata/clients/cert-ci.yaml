---
lookup_options:
  "^profile::jenkinscontroller::jcasc$":
    merge:
      strategy: deep
      merge_hash_arrays: true

profile::jenkinscontroller::ci_fqdn: 'cert.ci.jenkins.io'
profile::jenkinscontroller::proxy_port: 443
profile::jenkinscontroller::letsencrypt: false
profile::jenkinscontroller::groovy_init_enabled: false
profile::jenkinscontroller::memory_limit: '14g'
profile::jenkinscontroller::jcasc:
  enabled: true
  reload_token: ENC[PKCS7,MIIBiQYJKoZIhvcNAQcDoIIBejCCAXYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEABEfs+rIJcAI0m8IKKgDjuGY7VyibX+V/uQK55ir23b8hKS1CcpWIMt048rswRyMBxoUfqssSj/VfunEc0/XJ38/ewOUOgmNesnd41Zb531OuXnRM4CGk24fcgwNAD5XuMDMTRBf76RWDmMDbG1MvTBuq2hs2OYPOvzmoitVeiaCwf2rCJJi+1O0VIBCCaGcXbJ5mxcAKe0onu3SRKeFLCUc5qNY7yaCQTYW48cWdeh8M482CDNoCs4USt/pInlEmfK3LrZsNDhCe/YHOyxJEbOrzO3zW99Gxg0MZc3wdiZp1O/aw0v05ohDbrqcQt2A/TMxsJl9xeVXnyMwMOIh4rjBMBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDAdCli//H3PvL7TwGVW6hcgCA7cdPzrqU08q6u3Mqq8C7HjlRClGlbN2W1rN/E7o5EWw==]
  global_libraries:
    disabled: true
  tools:
    maven:
      mvn:
        disabled: true
      maven-3.5:
        version: "3.5.4"
      maven-3.6:
        version: "3.6.3"
      maven-3.8:
        version: "3.8.1"
      maven:
        home: "/usr/share/apache-maven-3.8.4"
    jdk:
      jdk-8: &tool_jdk8
        installers:
          linux-amd64:
            type: "command"
            label: "linux"
            command: "echo JDK8"
            toolHome: "/opt/jdk-8"
          windows-amd64:
            type: "batchFile"
            label: "windows"
            command: "echo JDK8"
            toolHome: "C:/Tools/jdk-8"
          default:
            type: "zip"
            version: "8u322-b06"
      jdk-11: &tool_jdk11
        installers:
          linux-amd64:
            type: "command"
            label: "linux"
            command: "echo JDK11"
            toolHome: "/opt/jdk-11"
          windows-amd64:
            type: "batchFile"
            label: "windows"
            command: "echo JDK11"
            toolHome: "C:/Tools/jdk-11"
          default:
            type: "zip"
            version: "11.0.12+7"
      # Use Yaml anchor to avoid repeating configuration
      jdk8: *tool_jdk8
      # Use Yaml anchor to avoid repeating configuration
      jdk11: *tool_jdk11
      jdk17:
        disabled: true
    generic:
      groovy-3.0.6:
        url: "https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-binary-3.0.6.zip"
  cloud_agents:
    azure-vm-agents:
      azureCredentialsId: "azure-sponsorship-credentials"
      resource_group: "certci-agents-2"
      agent_definitions:
        - name: "ubuntu"
          description: "Ubuntu 20.04 LTS (jdk11-default)"
          imageDefinition: jenkins-agent-ubuntu-20.04
          os: "ubuntu"
          storageAccount: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAfJd75oC4r6/feqjOc6DCQPzqTC7wAGsA1pVwrn1j/mm0hroqM5n03vy+t+tY3pnennuPxCJhtyyDPM9bH7LHjtiGilho2F8UOHl6qrQgf5lEf4f45Oo8wMw4pdkdH6rgVdX+xRBe3bMTSNmXqNLN/o6NYF9M3H5NbS7HbwCZ4QqWZOGMMFi2AClyuOf/QVTxLYtzG462zNzYzKMozytu8ZXgiZsGEB/YXC8+opaW+jpyMsDKy23mOiQxHPbW1KFt/jsT8nGUMRvpq9JxSTJ2B4dL5JVt9llLJcuXb5hGztq9P/qRQ93yK/gJmrexsu/DM3eGR+5HdmYX/c0ueC3R4zA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBArgE41Ni3oH5kkDAwhHUJOgBCKJjGeftsAOPGDV+p4dvUA]
          location: "East US 2"
          instanceType: Standard_DS4_v2 # 8 vCPUS / 28 Gb
          spotInstance: true
          architecture: amd64
          labels:
            - linux
          idleTerminationMinutes: 5
          maxInstances: 7 # Quota of 56 vCPUs
          useAsMuchAsPossible: true
          credentialsId: "azure-login"
          usePrivateIP: false
        - name: "win-2019" # The name must not contains "windows" or Azure API complains :facepalm:
          description: "Windows 2019"
          imageDefinition: jenkins-agent-windows-2019
          os: "windows"
          storageAccount: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAYjS5rZbvhOSp/e5QLkABkH5XgzFku3L7imaagPnUFcCyIvX+cgXms14GsJ3rvRaHoiyOk8ovtiPwTQ7J4LuoBgVBOSkHcCEJLbaHHNdn74JWO3owVzfHuSojN9AzVWTd8Jf/1gKWG7tzbTjIkJQMhKsH33FTtyEN63WjGqo1wEEhqSFKlsUleyfE+D+aBe1AeDp42J8+RB7LxobINQi965vfjuFjHIS3ix7GUvir/KkRV1rshWt26TA9SabAY5KiLlEHrxjgtAGbJGdraqblmOZHjc5a/BGXJqGEQyHGMWdf2xLxUOgNXoX5O5+1lWfOMl9pBDuEpYhJ1qR00WpunTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBVqd7WM6EjxJ+Fy0wn4SPUgBCrYZUZoU8TDYppNLoSnrur]
          location: "East US 2"
          instanceType: Standard_DS4_v2 # 8 vCPUS / 28 Gb
          spotInstance: true
          architecture: amd64
          labels:
            - windows
          idleTerminationMinutes: 5
          maxInstances: 7 # Quota of 56 vCPUs
          useAsMuchAsPossible: true
          credentialsId: "azure-login"
          usePrivateIP: false
## Ensure we override the default plugins to install defined from hieradata/common.yaml
profile::jenkinscontroller::plugins:
  # System configuration
  - azure-vm-agents
  - configuration-as-code
  - generic-tool
  - ldap
  - matrix-auth

  # Basic Pipeline configuration
  - github-branch-source
  - inline-pipeline
  - pipeline-groovy-lib

  # Pipeline steps
  - build-timeout
  - config-file-provider
  - junit-realtime-test-reporter
  - pipeline-stage-step # Used in mavenBuild
  - timestamper
  - workflow-basic-steps

  # Utility
  - compact-columns

  # Unused detached (disabled)
  - bouncycastle-api
  - command-launcher
  - jdk-tool
  - sshd
