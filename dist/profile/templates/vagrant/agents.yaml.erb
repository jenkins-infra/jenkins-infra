---
jenkins:
  systemMessage: "Jenkins configured automatically by Jenkins Configuration as Code plugin\n\n"
  ## Enable CLI
  remotingSecurity:
    enabled: true
  ## No build on master
  numExecutors: 0
  nodes:
  ## Dummy placeholder to create the agent (but nothing behind)
  - permanent:
      labelString: "linux dummy docker"
      launcher:
        ssh:
          credentialsId: "jenkins-agent-dummy"
          host: "jenkins-agent-dummy.local"
          launchTimeoutSeconds: 713
          port: 22
          retryWaitTime: 175
          sshHostKeyVerificationStrategy:
            manuallyProvidedKeyVerificationStrategy:
              key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHn7dpDVKMQTwvXGbErDFcnuxbf26QdQXGGhXNbLsNnt"
      mode: EXCLUSIVE
      name: "jenkins-agent-dummy"
      nodeProperties:
      - envVars:
          env:
          - key: "PATH+MAVEN"
            value: "/home/jenkins/tools/apache-maven-3.6.3/bin"
      - toolLocation:
          locations:
          - home: "/home/jenkins/tools/apache-maven-3.6.3"
            key: "hudson.tasks.Maven$MavenInstallation$DescriptorImpl@mvn"
      remoteFS: "/home/jenkins/ci.jenkins.io-agent"
      retentionStrategy: "always"
  clouds:
  - kubernetes:
      # 3 workers at 8 CPUs/32Gi each, smaller template is 1 CPU/1Gi (8*3=24)
      containerCap: 24
      credentialsId: "cik8s-kubeconfig"
      directConnection: true
      name: "cik8s"
      namespace: "jenkins-agents"
      serverUrl: "<%= @agents_kubernetes_cik8s_url %>"
      templates:
      - containers:
        - alwaysPullImage: true
          args: "1d"
          command: "sleep"
          image: "jenkins/inbound-agent:latest-jdk11"
          livenessProbe:
            failureThreshold: 0
            initialDelaySeconds: 0
            periodSeconds: 0
            successThreshold: 0
            timeoutSeconds: 0
          name: "jnlp"
          workingDir: "/home/jenkins"
        id: "f79567d4-f550-44b3-a9ce-70cf291910e6"
        name: "jnlp"
        slaveConnectTimeout: 100
        yamlMergeStrategy: "override"
      - containers:
        - alwaysPullImage: true
          args: "^${computer.jnlpmac} ^${computer.name}"
          command: "/usr/local/bin/jenkins-agent"
          image: "jenkinsciinfra/inbound-agent-ruby"
          livenessProbe:
            failureThreshold: 0
            initialDelaySeconds: 0
            periodSeconds: 0
            successThreshold: 0
            timeoutSeconds: 0
          name: "jnlp"
          workingDir: "/home/jenkins"
        id: "f79567d4-f550-44b3-a9ce-70cf291910e6"
        label: "ruby container kubernetes"
        name: "jnlp-ruby"
        slaveConnectTimeout: 100
        yamlMergeStrategy: "override"
